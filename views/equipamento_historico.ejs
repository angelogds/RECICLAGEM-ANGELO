<% layout('layout', { title: "Histórico do Equipamento", active: "equipamentos" }) %>

<h1 class="page-title">
    <i class="fa-solid fa-clock-rotate-left"></i> Histórico — <%= equipamento.nome %>
</h1>

<!-- CARD DO EQUIPAMENTO -->
<div class="card equip-card">

    <div class="equip-info">

        <div class="equip-text">
            <p><strong>ID:</strong> <%= equipamento.id %></p>
            <p><strong>Código:</strong> <%= equipamento.codigo || "-" %></p>
            <p><strong>Local:</strong> <%= equipamento.local || "-" %></p>
        </div>

        <% if (equipamento.imagem) { %>
            <div class="equip-img-box">
                <img src="/<%= equipamento.imagem %>" class="equip-preview">
            </div>
        <% } %>

    </div>

</div>

<!-- SEPARADOR -->
<h2 class="section-title">
    <i class="fa-solid fa-list-check"></i> Ordens de Serviço
</h2>

<!-- TABELA DE ORDENS -->
<div class="card table-card">
    <table class="table-modern">
        <thead>
            <tr>
                <th>ID</th>
                <th>Tipo</th>
                <th>Status</th>
                <th>Abertura</th>
                <th>Fechamento</th>
                <th class="center">Ações</th>
            </tr>
        </thead>

        <tbody>

            <% if (ordens.length === 0) { %>
                <tr>
                    <td colspan="6" class="empty">Nenhuma ordem encontrada.</td>
                </tr>
            <% } %>

            <% ordens.forEach(o => { %>
                <tr>
                    <td><%= o.id %></td>
                    <td><%= o.tipo %></td>

                    <td>
                        <% if (o.status === "aberta") { %>
                            <span class="tag yellow">Aberta</span>
                        <% } else { %>
                            <span class="tag green">Fechada</span>
                        <% } %>
                    </td>

                    <td><%= o.aberta_em %></td>
                    <td><%= o.fechada_em || "-" %></td>

                    <td class="center">
                        <a href="/ordens/<%= o.id %>" class="btn-sm btn-edit">
                            <i class="fa-solid fa-eye"></i>
                        </a>
                    </td>
                </tr>
            <% }) %>

        </tbody>
    </table>
</div>

<!-- SEPARADOR -->
<h2 class="section-title">
    <i class="fa-solid fa-gears"></i> Consumo de Correias
</h2>

<!-- TABELA DE CONSUMOS -->
<div class="card table-card">
    <table class="table-modern">
        <thead>
            <tr>
                <th>Correia</th>
                <th>Quantidade</th>
                <th>Data</th>
            </tr>
        </thead>

        <tbody>

            <% if (correias.length === 0) { %>
                <tr>
                    <td colspan="3" class="empty">Nenhum consumo registrado.</td>
                </tr>
            <% } %>

            <% correias.forEach(c => { %>
                <tr>
                    <td><%= c.correia %></td>
                    <td>
                        <span class="tag <%= c.quantidade > 1 ? 'yellow' : 'red' %>">
                            <%= c.quantidade %>
                        </span>
                    </td>
                    <td><%= c.data %></td>
                </tr>
            <% }) %>

        </tbody>
    </table>
</div>

<style>
/* ESTILO ESPECIAL DO HISTÓRICO */

.equip-card { margin-bottom: 25px; }

.equip-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.equip-preview {
    width: 120px;
    height: 120px;
    border-radius: 12px;
    object-fit: cover;
    border: 3px solid #e1f4e8;
}

.section-title {
    margin: 25px 0 12px;
    font-size: 20px;
    color: var(--green-700);
}
</style>
