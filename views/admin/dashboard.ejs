<% layout('layout', { title: "Dashboard", active: "dashboard" }) %>

<h1 class="page-title">Dashboard BonitÃ£o âœ”ï¸</h1>

<div class="dashboard-grid">

    <!-- CARD 1 -->
    <div class="dash-card">
        <div class="dash-icon bg-green">
            ğŸ“¦
        </div>
        <div class="dash-info">
            <h3>Equipamentos</h3>
            <p><%= totals.equipamentos %></p>
        </div>
    </div>

    <!-- CARD 2 -->
    <div class="dash-card">
        <div class="dash-icon bg-blue">
            ğŸ› ï¸
        </div>
        <div class="dash-info">
            <h3>Ordens Abertas</h3>

            <p><%= totals.abertas %></p>
        </div>
    </div>

    <!-- CARD 3 -->
    <div class="dash-card">
        <div class="dash-icon bg-orange">
            âœ”ï¸
        </div>
        <div class="dash-info">
            <h3>Ordens Fechadas</h3>
            <p><%= totals.fechadas %></p>
        </div>
    </div>

</div>


<!-- GRÃFICOS -->
<div class="charts-container">

    <div class="chart-card">
        <h3>Ordens por Tipo</h3>
        <canvas id="chartTipos"></canvas>
    </div>

    <div class="chart-card">
        <h3>Status das Ordens</h3>
        <canvas id="chartStatus"></canvas>
    </div>

</div>

<!-- ULTIMAS ORDENS -->
<div class="list-card">
    <h3>Ãšltimas Ordens Abertas</h3>

    <% if (ultimas.length === 0) { %>
        <p>Nenhuma ordem aberta recentemente.</p>
    <% } else { %>
        <ul class="ultima-lista">
            <% ultimas.forEach(u => { %>
                <li>
                    <strong><%= u.id %></strong> â€” <%= u.equipamento_nome || "Sem equipamento" %>  
                    <span class="badge"><%= u.tipo %></span>
                </li>
            <% }); %>
        </ul>
    <% } %>

</div>


<!-- Chart JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // === GRÃFICO 1 - Tipos ===
    const ctxTipos = document.getElementById('chartTipos');
    new Chart(ctxTipos, {
        type: 'bar',
        data: {
            labels: <%- JSON.stringify(tipos.labels) %>,
            datasets: [{
                label: 'Quantidade',
                data: <%- JSON.stringify(tipos.valores) %>,
            }]
        },
    });

    // === GRÃFICO 2 - Status ===
    const ctxStatus = document.getElementById('chartStatus');
    new Chart(ctxStatus, {
        type: 'pie',
        data: {
            labels: ['Abertas', 'Fechadas'],
            datasets: [{
                data: [<%= totals.abertas %>, <%= totals.fechadas %>],
            }]
        }
    });
</script>
