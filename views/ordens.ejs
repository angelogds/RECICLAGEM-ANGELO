<h1 class="page-title">
    <i class="fa-solid fa-list-check"></i> Ordens de Serviço
</h1>

<div style="margin-bottom:20px;">
    <a href="/ordens/novo" class="btn-primary">
        <i class="fa-solid fa-plus"></i> Abrir Nova OS
    </a>
</div>

<div class="card" style="
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 2px 6px #00000015;
">

    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Equipamento</th>
                <th>Tipo</th>
                <th>Solicitante</th>
                <th>Status</th>
                <th>Data</th>
                <th style="text-align:center;">Ações</th>
            </tr>
        </thead>

        <tbody>

            <% if (ordens.length === 0) { %>
                <tr>
                    <td colspan="7" style="text-align:center; opacity:0.6; padding:15px;">
                        Nenhuma ordem encontrada.
                    </td>
                </tr>
            <% } %>

            <% ordens.forEach(o => { %>
                <tr>
                    <td><%= o.id %></td>
                    <td><%= o.equipamento_nome || '-' %></td>
                    <td><%= o.tipo %></td>
                    <td><%= o.solicitante %></td>

                    <td>
                        <% if (o.status === 'aberta') { %>
                            <span style="
                                background:#d8f3dc;
                                color:#064e3b;
                                padding:6px 10px;
                                border-radius:6px;
                                font-weight:600;
                                font-size:13px;
                            ">Aberta</span>
                        <% } else { %>
                            <span style="
                                background:#eee;
                                padding:6px 10px;
                                border-radius:6px;
                                font-weight:600;
                                font-size:13px;
                            ">Fechada</span>
                        <% } %>
                    </td>

                    <td><%= o.aberta_em %></td>

                    <td class="actions">

                        <!-- Ver -->
                        <a href="/ordens/<%= o.id %>" class="btn-edit" title="Ver OS">
                            <i class="fa-solid fa-eye"></i>
                        </a>

                        <!-- Fechar -->
                        <% if (session.role === 'admin' || (session.role === 'operador' && o.solicitante === session.usuario)) { %>
                            <form method="POST"
                                  action="/ordens/<%= o.id %>/fechar"
                                  style="display:inline-block;">
                                <input type="hidden" name="resultado" value="Fechado via lista">
                                <button class="btn-edit" style="background:#0b6b2e; color:white;" title="Fechar OS">
                                    <i class="fa-solid fa-lock"></i>
                                </button>
                            </form>
                        <% } %>

                        <!-- Excluir -->
                        <form method="POST"
                              action="/ordens/<%= o.id %>/delete"
                              onsubmit="return confirm('Excluir essa OS?');"
                              style="display:inline-block;">
                            <button class="btn-delete" title="Excluir">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </form>

                    </td>
                </tr>
            <% }) %>

        </tbody>
    </table>

</div>
