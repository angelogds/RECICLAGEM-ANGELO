<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Ordens de Servi√ßo - Admin</title>
  <link rel="stylesheet" href="/public/style.css">
</head>
<body>
  <% include ../partials/cabecalho.ejs %>

  <main class="container">
    <h1>üõ†Ô∏è Ordens de Servi√ßo</h1>

    <% if (ordens.length === 0) { %>
      <p>Nenhuma ordem de servi√ßo registrada ainda.</p>
    <% } else { %>
      <table class="tabela">
        <thead>
          <tr>
            <th>ID</th>
            <th>Equipamento</th>
            <th>Descri√ß√£o</th>
            <th>Status</th>
            <th>T√©cnico</th>
            <th>Abertura</th>
            <th>In√≠cio</th>
            <th>Fechamento</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <% ordens.forEach(os => { %>
            <tr>
              <td><%= os.id %></td>
              <td><%= os.equipamento_nome %></td>
              <td><%= os.descricao %></td>
              <td><%= os.status %></td>
              <td><%= os.tecnico_nome || "-" %></td>
              <td><%= os.data_abertura %></td>
              <td><%= os.data_inicio || "-" %></td>
              <td><%= os.data_fechamento || "-" %></td>
              <td>
                <% if (os.status === "Aberta") { %>
                  <form action="/admin/ordens/<%= os.id %>/start" method="POST" style="display:inline;">
                    <input type="text" name="tecnico_nome" placeholder="Nome do t√©cnico" required>
                    <button type="submit" class="btn">‚ñ∂Ô∏è Iniciar</button>
                  </form>
                <% } else if (os.status === "Em Andamento") { %>
                  <form action="/admin/ordens/<%= os.id %>/finish" method="POST" enctype="multipart/form-data" style="display:inline;">
                    <input type="file" name="foto_depois" accept="image/*" required>
                    <button type="submit" class="btn">‚úÖ Finalizar</button>
                  </form>
                <% } else { %>
                  <span>‚úîÔ∏è Conclu√≠da</span>
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>

    <p>
      <a href="/admin/ordens/report" class="btn">üìÑ Gerar Relat√≥rio PDF</a>
    </p>
  </main>

  <% include ../partials/rodape.ejs %>
</body>
</html>
