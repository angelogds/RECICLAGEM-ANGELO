<h1 class="page-title">Ordem de Servi√ßo #<%= ordem.id %></h1>

<div class="card">

    <p><strong>Equipamento:</strong> <%= ordem.equipamento_nome || "-" %> (<%= ordem.equipamento_codigo || "-" %>)</p>
    <p><strong>Solicitante:</strong> <%= ordem.solicitante || "-" %></p>
    <p><strong>Tipo:</strong> <%= ordem.tipo || "-" %></p>

    <p><strong>Status:</strong> 
        <% if (ordem.status === "aberta") { %>
            <span class="tag aberta">Aberta</span>
        <% } else { %>
            <span class="tag fechada">Fechada</span>
        <% } %>
    </p>

    <p><strong>Data de Abertura:</strong> <%= ordem.aberta_em %></p>

    <h3>Descri√ß√£o da OS</h3>
    <div class="descricao-box"><%= ordem.descricao %></div>

    <% if (ordem.status === "fechada") { %>

        <h3>Resultado do Servi√ßo</h3>
        <div class="descricao-box"><%= ordem.resultado %></div>

        <!-- =============================
             GALERIA MODERNA DE FOTOS
        ============================== -->
        <h3 style="margin-top:25px;">üì∏ Fotos da Ordem</h3>

        <div class="galeria">
        <% if (fotos.length === 0) { %>
            <p style="color:#777;">Nenhuma foto enviada.</p>
        <% } else { %>
            <% fotos.forEach(f => { %>
                <div class="foto-item">
                    <img src="/<%= f.caminho %>" onclick="abrirZoom('/<%= f.caminho %>')" />
                    <span class="foto-legenda">
                        <%= f.tipo === 'abertura' ? 'Abertura' : 'Fechamento' %>
                    </span>
                </div>
            <% }) %>
        <% } %>
        </div>

        <!-- MODAL -->
        <div id="zoomModal" class="zoom-modal" onclick="fecharZoom()">
            <img id="zoomImg">
        </div>
        <!-- FIM GALERIA -->

        <p><strong>Fechada em:</strong> <%= ordem.fechada_em %></p>

        <a href="/solicitacao/pdf/<%= ordem.id %>" class="btn-download">Baixar PDF</a>

    <% } %>

</div>

<!-- =============================
     FORMUL√ÅRIO PARA FECHAR A OS
============================= -->
<% if (ordem.status === "aberta") { %>

<h2>Fechar esta OS</h2>

<form method="POST" action="/ordens/<%= ordem.id %>/fechar" 
      enctype="multipart/form-data"  <!-- IMPORTANTE -->
      class="form-card">

    <label>Resultado do Servi√ßo</label>
    <textarea name="resultado" rows="4" required></textarea>

    <label>Fotos do Servi√ßo (opcional)</label>
    <input type="file" name="fotos" accept="image/*" multiple>

    <button class="btn-save">Fechar OS</button>
</form>

<% } %>

<!-- =============== JS do ZOOM =============== -->
<script>
function abrirZoom(src) {
    document.getElementById('zoomModal').style.display = 'flex';
    document.getElementById('zoomImg').src = src;
}
function fecharZoom() {
    document.getElementById('zoomModal').style.display = 'none';
}
</script>
