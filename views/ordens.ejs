<h1 class="page-title">
    <i class="fa-solid fa-clipboard-list"></i>
    Ordens de Serviço
</h1>

<div style="margin-bottom: 20px;">
    <a href="/os/nova" class="btn-primary">
        <i class="fa-solid fa-plus"></i> Abrir Nova OS
    </a>
</div>

<div class="card" style="overflow-x:auto;">
    <table class="table-modern">
        <thead>
            <tr>
                <th>ID</th>
                <th>Equipamento</th>
                <th>Tipo</th>
                <th>Solicitante</th>
                <th>Status</th>
                <th>Data</th>
                <th style="text-align:center;">Ações</th>
            </tr>
        </thead>

        <tbody>

            <% if (ordens.length === 0) { %>
            <tr>
                <td colspan="7" class="empty">Nenhuma OS encontrada.</td>
            </tr>
            <% } %>

            <% ordens.forEach(o => { %>
            <tr>
                <td><%= o.id %></td>
                <td><%= o.equipamento %></td>
                <td><%= o.tipo %></td>
                <td><%= o.solicitante %></td>

                <td>
                    <% if (o.status === 'Aberta') { %>
                        <span class="tag green">Aberta</span>
                    <% } else { %>
                        <span class="tag warn">Fechada</span>
                    <% } %>
                </td>

                <td><%= o.aberta_em %></td>

                <td class="actions">

                    <!-- Editar -->
                    <a href="/os/<%= o.id %>/editar" class="btn-action btn-edit">
                        <i class="fa-solid fa-pen"></i>
                        <span class="btn-label">Editar</span>
                    </a>

                    <!-- Ver -->
                    <a href="/os/<%= o.id %>" class="btn-action btn-view" style="background:#0b5e33;">
                        <i class="fa-solid fa-eye"></i>
                        <span class="btn-label">Ver</span>
                    </a>

                    <!-- Fechar -->
                    <% if (o.status === 'Aberta') { %>
                    <a href="/os/<%= o.id %>/fechar" class="btn-action" style="background:#0d6efd;">
                        <i class="fa-solid fa-lock"></i>
                        <span class="btn-label">Fechar</span>
                    </a>
                    <% } %>

                    <!-- Excluir -->
                    <form method="POST" action="/os/<%= o.id %>/delete" 
                          onsubmit="return confirm('Excluir esta OS?');"
                          style="display:inline;">
                        <button class="btn-action btn-delete">
                            <i class="fa-solid fa-trash"></i>
                            <span class="btn-label">Excluir</span>
                        </button>
                    </form>

                </td>
            </tr>
            <% }) %>

        </tbody>
    </table>
</div>
